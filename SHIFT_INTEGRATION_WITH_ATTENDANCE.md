# ๐ ุชูุงูู ูุธุงู ุงูุดููุชุงุช ูุน ุงูุญุถูุฑ ูุงูุฑูุงุชุจ

## ๐ ููุฎุต ุงูุชุญุฏูุซุงุช

ุชู ุชุญุฏูุซ ุงููุธุงู ุงููุฏูู ููุญุถูุฑ ูุงูุงูุตุฑุงู ููุชูุงูู ูุน ูุธุงู ุงูุดููุชุงุช ุงูุฃุณุจูุนูุฉ ุงูุฌุฏูุฏ (`WeeklyShiftSchedule`).

---

## โ ูุง ุชู ุชุญุฏูุซู

### 1. **CheckInView** - ุชุณุฌูู ุงูุญุถูุฑ โ

**ุงูููู:** `hr_management/views.py`

**ุงูุชุญุฏูุซุงุช:**
- โ ููุญุต ุฌุฏูู ุงูุดููุช ุงูุฃุณุจูุนู (`WeeklyShiftSchedule`) ููููุธู
- โ ูุญุฏุฏ ุงูููู ุงูุญุงูู ูู ุงูุฃุณุจูุน (ุงูุฃุญุฏ=0, ุงูุฅุซููู=1, ... ุงูุณุจุช=6)
- โ ููุงุฑู ููุช ุงูุญุถูุฑ ุงููุนูู ุจููุช ุงูุจุฏุงูุฉ ุงููุชููุน
- โ **ูุชุฑุฉ ุณูุงุญ:** 15 ุฏูููุฉ
  - ุฅุฐุง ุญุถุฑ ุงูููุธู ุฎูุงู 15 ุฏูููุฉ ูู ููุช ุงูุจุฏุงูุฉ โ `present`
  - ุฅุฐุง ุญุถุฑ ุจุนุฏ 15 ุฏูููุฉ โ `late` + ูุญุณุจ ุฏูุงุฆู ุงูุชุฃุฎูุฑ
- โ ูุญุฏุซ ุญุงูุฉ ุงูุญุถูุฑ ูู `EmployeeAttendance` ุชููุงุฆูุงู

**ูุซุงู:**
```python
# ุงูุดููุช: 6:00 AM - 10:00 AM
# ุงูุญุถูุฑ ุงูุณุงุนุฉ 6:10 AM โ present โ
# ุงูุญุถูุฑ ุงูุณุงุนุฉ 6:20 AM โ late (20 ุฏูููุฉ ุชุฃุฎูุฑ) โ๏ธ
```

### 2. **CheckOutView** - ุชุณุฌูู ุงูุงูุตุฑุงู โ

**ุงูููู:** `hr_management/views.py`

**ุงูุชุญุฏูุซุงุช:**
- โ ููุญุต ุฌุฏูู ุงูุดููุช ุงูุฃุณุจูุนู
- โ ูุญุณุจ ุฅุฌูุงูู ุณุงุนุงุช ุงูุนูู ุงููุนููุฉ
- โ **ุฎุตู ููุช ุงูุงุณุชุฑุงุญุฉ:** ุณุงุนุฉ ูุงุญุฏุฉ ููุดููุชุงุช ุฃูุซุฑ ูู 6 ุณุงุนุงุช
- โ **ุญุณุงุจ ุงูุณุงุนุงุช ุงูุฅุถุงููุฉ:**
  - ูุชุฑุฉ ุณูุงุญ: 30 ุฏูููุฉ ุจุนุฏ ููุช ููุงูุฉ ุงูุดููุช
  - ุฅุฐุง ุงูุตุฑู ุจุนุฏ 30 ุฏูููุฉ ูู ููุช ุงูููุงูุฉ โ ูุญุณุจ overtime
- โ ูุฑุฌุน `total_hours` ู `overtime_minutes` ูู ุงูู response

**ูุซุงู:**
```python
# ุงูุดููุช: 6:00 AM - 10:00 AM (4 ุณุงุนุงุช)
# ุงูุงูุตุฑุงู ุงูุณุงุนุฉ 10:20 AM โ ูุง ุชูุฌุฏ ุณุงุนุงุช ุฅุถุงููุฉ (ุถูู ูุชุฑุฉ ุงูุณูุงุญ)
# ุงูุงูุตุฑุงู ุงูุณุงุนุฉ 11:00 AM โ 30 ุฏูููุฉ ุณุงุนุงุช ุฅุถุงููุฉ โฐ
```

### 3. **WorkShift Signal** - ุญุณุงุจ ุงูุฑูุงุชุจ โ

**ุงูููู:** `hr_management/signals.py`

**ุงูุชุญุฏูุซุงุช:**
- โ ูุณุชุฎุฏู `WeeklyShiftSchedule` ุจุฏูุงู ูู `employee.shift_start_time/end_time` ุงููุฏูู
- โ ูุญุณุจ ุงูุฑุงุชุจ ุจูุงุกู ุนูู:
  1. **ุงูุณุงุนุงุช ุงููุฌุฏููุฉ** ูู `WeeklyShiftSchedule`
  2. **ุงูุณุงุนุงุช ุงููุนููุฉ** ูู `WorkShift.check_in/check_out`
  3. **ูุชุฑุฉ ุงูุณูุงุญ ููุชุฃุฎูุฑ:** 15 ุฏูููุฉ
  4. **ุฎุตู ููุช ุงูุงุณุชุฑุงุญุฉ:** 60 ุฏูููุฉ ููุดููุชุงุช ุงูุทูููุฉ
  5. **ุงูุณุงุนุงุช ุงูุฅุถุงููุฉ:** ูุนุฏู 1.5x ุฃู `employee.overtime_rate`

**ูุนุงุฏูุฉ ุงูุฑุงุชุจ:**
```python
hourly_rate = (monthly_salary / 30) / 8  # ุฑุงุชุจ ุงูุณุงุนุฉ
base_pay = hourly_rate * actual_hours_worked
overtime_pay = overtime_rate * overtime_hours
total_salary = base_pay + overtime_pay
```

**ุงูุญุฏ ุงูุฃุฏูู:**
- ุฅุฐุง ุนูู ุงูููุธู ุฃูู ูู ุณุงุนุฉ โ ูุง ุฑุงุชุจ โ
- ุฅุฐุง ุนูู ุงูููุธู ุณุงุนุฉ ุฃู ุฃูุซุฑ โ ูุญุณุจ ุงูุฑุงุชุจ ุญุณุจ ุงูุณุงุนุงุช โ

---

## ๐ง ููููุฉ ุงูุนูู

### ุงูุณููุงุฑูู ุงููุงูู:

#### 1. **ุฅูุดุงุก ุฌุฏูู ุดููุช ุฃุณุจูุนู**
```bash
POST /hr/api/shift-schedules/bulk_create/
{
  "employee": "uuid-here",
  "schedules": [
    {"day_of_week": 6, "start_time": "06:00", "end_time": "10:00"}  # ุงูุณุจุช
  ]
}
```

#### 2. **ุงูููุธู ูุณุฌู ุญุถูุฑ**
```bash
POST /hr/attendance/checkin/{employee_id}/
Response:
{
  "status": "late",  # ุฃู "present"
  "is_late": true,
  "late_minutes": 20,
  "expected_start": "06:00:00"
}
```

#### 3. **ุงูููุธู ูุณุฌู ุงูุตุฑุงู**
```bash
POST /hr/attendance/checkout/{employee_id}/
Response:
{
  "total_hours": 4.5,
  "overtime_minutes": 30
}
```

#### 4. **ุญุณุงุจ ุงูุฑุงุชุจ ุชููุงุฆูุงู**
ุนูุฏ ุญูุธ `WorkShift.check_out`ุ ูุชู:
- โ ุญุณุงุจ ุงูุณุงุนุงุช ุงููุนููุฉ
- โ ุฎุตู ููุช ุงูุงุณุชุฑุงุญุฉ
- โ ุญุณุงุจ ุงูุณุงุนุงุช ุงูุฅุถุงููุฉ
- โ ุฅุถุงูุฉ ุงูุฑุงุชุจ ุฅูู `MainWallet`

---

## ๐ ุงููุฑู ุจูู ุงููุธุงู ุงููุฏูู ูุงูุฌุฏูุฏ

| ุงูููุฒุฉ | ุงููุธุงู ุงููุฏูู | ุงููุธุงู ุงูุฌุฏูุฏ |
|--------|---------------|---------------|
| **ุชุญุฏูุฏ ุงูุดููุช** | `employee.shift_start_time` ุซุงุจุช | `WeeklyShiftSchedule` - ุดููุช ูุฎุชูู ููู ููู |
| **ูุดู ุงูุชุฃุฎูุฑ** | ูุฏูู ุฃู ุบูุฑ ุฏููู | ุชููุงุฆู ุจูุงุกู ุนูู ุงูุดููุช ุงููุญุฏุฏ + 15 ุฏูููุฉ ุณูุงุญ |
| **ุญุณุงุจ ุงูุณุงุนุงุช ุงูุฅุถุงููุฉ** | ุบูุฑ ูุฏุนูู | ุชููุงุฆู: ููุช ุงูููุงูุฉ + 30 ุฏูููุฉ ุณูุงุญ |
| **ุญุณุงุจ ุงูุฑุงุชุจ** | ุซุงุจุช ููููุงู | ูุนุชูุฏ ุนูู ุงูุณุงุนุงุช ุงููุนููุฉ ูู ุงูุดููุช |
| **ุฌุฏุงูู ูุฑูุฉ** | โ | โ ุดููุช ูุฎุชูู ููู ููู ูู ุงูุฃุณุจูุน |

---

## ๐งฎ ุฃูุซูุฉ ุญุณุงุจูุฉ

### **ูุซุงู 1: ุญุถูุฑ ูู ุงูููุช**
- **ุงูุดููุช ุงููุญุฏุฏ:** 6:00 AM - 10:00 AM (4 ุณุงุนุงุช)
- **ุงูุญุถูุฑ ุงููุนูู:** 6:10 AM
- **ุงูุงูุตุฑุงู ุงููุนูู:** 10:00 AM
- **ุงููุชูุฌุฉ:**
  - Status: `present` โ
  - Late minutes: 0
  - Total hours: 3.83 hours (ุฎุตู 10 ุฏูุงุฆู ููู ุถูู ุงูุณูุงุญ)
  - Overtime: 0

### **ูุซุงู 2: ุชุฃุฎูุฑ + ุณุงุนุงุช ุฅุถุงููุฉ**
- **ุงูุดููุช ุงููุญุฏุฏ:** 6:00 AM - 10:00 AM (4 ุณุงุนุงุช)
- **ุงูุญุถูุฑ ุงููุนูู:** 6:20 AM
- **ุงูุงูุตุฑุงู ุงููุนูู:** 11:00 AM
- **ุงููุชูุฌุฉ:**
  - Status: `late` โ๏ธ
  - Late minutes: 20
  - Total hours: 4.67 hours
  - Overtime: 30 minutes (60 ุฏูููุฉ ุจุนุฏ ุงูููุงูุฉ - 30 ุฏูููุฉ ุณูุงุญ)

### **ูุซุงู 3: ุดููุช ุทููู**
- **ุงูุดููุช ุงููุญุฏุฏ:** 8:00 AM - 6:00 PM (10 ุณุงุนุงุช)
- **ุงูุญุถูุฑ ุงููุนูู:** 8:00 AM
- **ุงูุงูุตุฑุงู ุงููุนูู:** 6:00 PM
- **ุงููุชูุฌุฉ:**
  - Status: `present` โ
  - Total hours: 9 hours (ุฎุตู ุณุงุนุฉ ุงุณุชุฑุงุญุฉ)
  - Overtime: 0

---

## ๐ Debugging

### **ูุดููุฉ: ุงูููุธู ุญุงุถุฑ ูู ุงูููุช ููู ูุธูุฑ "late"**

**ุงูุณุจุจ ุงููุญุชูู:**
1. ูุง ููุฌุฏ `WeeklyShiftSchedule` ูุญุฏุฏ ููุฐุง ุงูููู
2. ุงูููู ูู ุงูุฃุณุจูุน ูุญุณูุจ ุฎุทุฃ
3. ููุช ุงูุจุฏุงูุฉ ูู ุงูู schedule ูุฎุชูู ุนู ุงููุชููุน

**ุงูุญู:**
```python
# ุงูุญุต ุงูุดููุช
GET /hr/api/shift-schedules/employee_schedule/?employee_id={UUID}

# ุชุฃูุฏ ูู:
# 1. day_of_week ุตุญูุญ (ุงูุณุจุช=6, ุงูุฃุญุฏ=0)
# 2. start_time ู end_time ุตุญูุญุฉ
# 3. is_active = true
```

### **ูุดููุฉ: ุงูุฑุงุชุจ ูุง ููุญุณุจ**

**ุงูุณุจุจ ุงููุญุชูู:**
1. `WorkShift.check_out` ูุงุฑุบ
2. ูุง ููุฌุฏ `WeeklyShiftSchedule` ููุฐุง ุงูููู
3. ุงูููุธู ุนูู ุฃูู ูู ุณุงุนุฉ

**ุงูุญู:**
```python
# ุงูุญุต ุงูู WorkShift
GET /hr/api/work-shifts/?employee_id={UUID}&date={DATE}

# ุชุฃูุฏ ูู:
# 1. check_in ู check_out ูุญุฏุฏูู
# 2. duration_minutes > 60
```

---

## ๐ ููุงุญุธุงุช ูููุฉ

### โ๏ธ **Backward Compatibility**
- ุงููุธุงู ุงููุฏูู ูุง ูุฒุงู ูุนูู ุฅุฐุง ูู ููู ููุงู `WeeklyShiftSchedule` ูุญุฏุฏ
- ูู ุญุงูุฉ ุนุฏู ูุฌูุฏ scheduleุ ูุชู:
  - ุงูุญุถูุฑ: ูุณุฌู ูู `present` ุจุฏูู ูุญุต ุงูุชุฃุฎูุฑ
  - ุงูุงูุตุฑุงู: ูุญุณุจ ุงูุณุงุนุงุช ุจุฏูู overtime
  - ุงูุฑุงุชุจ: ูุณุชุฎุฏู 8 ุณุงุนุงุช ููููุฉ ุงูุชุฑุงุถูุฉ

### โ **ุฃูุถู ุงูููุงุฑุณุงุช**
1. **ุฅูุดุงุก ุฌุฏุงูู ุดููุช ูุฌููุน ุงูููุธููู** ูู `/dashboard/shifts/schedules`
2. **ูุฑุงุฌุนุฉ ุงูุฌุฏุงูู ุฃุณุจูุนูุงู** ููุชุฃูุฏ ูู ุตุญุชูุง
3. **ุงุณุชุฎุฏุงู ุงูู Live Monitor** ูู `/dashboard/shifts/monitor` ููุชุงุจุนุฉ ุงูุญุถูุฑ
4. **ุงูุชุญูู ูู ุงูุฑูุงุชุจ** ุจุนุฏ ูู ุฏูุฑุฉ ุฏูุน

---

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ (ุงุฎุชูุงุฑูุฉ)

1. โ **ุชูุงุฑูุฑ ูุชูุฏูุฉ:** ุตูุญุฉ ูุนุฑุถ ุชูุฑูุฑ ุดูุฑู ุจุงูุณุงุนุงุช ูุงูุชุฃุฎูุฑุงุช
2. โ **ุฅุดุนุงุฑุงุช:** ุฅุฑุณุงู ุชูุจูู ุนูุฏ ุงูุชุฃุฎูุฑ ุงููุชูุฑุฑ
3. โ **ุชุตุฏูุฑ Excel:** ุชุตุฏูุฑ ุจูุงูุงุช ุงูุญุถูุฑ ูุงูุฑูุงุชุจ
4. โ **Dashboard ููููุธู:** ุงูุณูุงุญ ููููุธู ุจุฑุคูุฉ ุดููุชู ูุณุงุนุงุชู

---

## ๐ Support

ุฅุฐุง ูุงุฌูุช ุฃู ูุดููุฉ:
1. ุชุญูู ูู ุงูู Django logs: `python manage.py runserver`
2. ุชุญูู ูู ุงูู database: `WeeklyShiftSchedule`, `WorkShift`, `EmployeeAttendance`
3. ุฑุงุฌุน ุงูู signals ูู `hr_management/signals.py`

---

**ุชุงุฑูุฎ ุงูุชุญุฏูุซ:** ุฃูุชูุจุฑ 2025  
**ุงูุฅุตุฏุงุฑ:** 2.0
